```{r setup, include=FALSE, echo=FALSE}
options(
  encoding = "UTF-8",
  knitr.kable.NA = "",
  knitr.kable.digits = 2
)

knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(result = "hold")
knitr::opts_chunk$set(fig.align = "center")


if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)

if(!require("scales")) install.packages("scales")
library(scales)

if(!require("kableExtra")) install.packages("kableExtra")
library(kableExtra)

```

```{r}
app.table.default <- function(data, align = NULL, caption = NULL, format.args = list(big.mark = ".", decimal.mark =",", nsmall = 2), col.names = NULL) {
  tbl <- knitr::kable(data, align=align, caption = caption, format.args = format.args, col.names = col.names)
  tbl <- kable_classic(tbl)
  tbl <- kable_styling(tbl, position = "center", bootstrap_options = c("condensed"))
  return(tbl)
}

app.plot.theming <- function(g) {
  return(
    g +
      theme(
        legend.position = "top",
        legend.justification = "left",
        legend.title = element_blank(),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.background = element_rect(fill = "transparent")
        ) +
      xlab(NULL) +
      ylab(NULL)
  )
}

app.color.primary <- "black"
app.color.secondary <- "grey"
```

```{r}
ds_file <- "indicadores rpps.xlsx"
df <- readxl::read_excel(ds_file, sheet = "Periodo")
data_base <- as.Date(df$data_base[1])
periodo <- format(data_base, format = "%B de %Y")
ano_base <- format(data_base, format = "%Y")
```

---
title: "Indicadores Fiscais e Gerenciais do FPSM"
author: "Everton da Rosa"
date: "`r periodo`"
---

***

Este relatório tem o objetivo de apresentar os principais indicadores gerenciais relativos ao **Fundo de Previdência dos Servidores Municipais (RPPS)** do **Município de Independência/RS**.

***

# Indicadores Gerenciais

Nesta seção estão apresentados alguns indicadores de cunho gerencial com a finalidade de auxiliar a gestão do RPPS nas decisões que envolvam aspectos contábeis, orçamentários e financeiros.

## Receita Orçamentária
A receita engloba a receita orçamentária e intra-orçamentária arrecadada pelo RPPS, em termos líquidos de suas deduções.

Os valores são apresentados em termos mensais e acumulados até o mês de referência, comparados aos valores efetivamente realizados no ano anterior e com os valores previstos na lei orçamentária anual.

### Receita Total

Engloba toda a receita do FPSM, inclusive a intra-orçamentária, já líquida das deduções.

```{r}
df <- readxl::read_excel(ds_file, sheet = "ReceitaTotal")
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant,	prev_mes,	arrec_mes),
  align=c("l", "r", "r", "r"),
  caption = "Receita Total (Mensal)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant_acum,	prev_acum,	arrec_acum),
  align=c("l", "r", "r", "r"),
  caption = "Receita Total (Acumulado)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```

```{r}
data <- select(df, mes, arrec_ant,	arrec_mes)
ant <- select(data, mes, arrec_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant
ant$arrec_ant <- NULL
atual <- select(data, mes, arrec_mes)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_mes
atual$arrec_mes <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle("Receita Total: ano anterior x ano atual - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_mes)
prev$valor <- prev$prev_mes
prev$prev_mes <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_mes)
arrec$valor <- arrec$arrec_mes
arrec$arrec_mes <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Receita Total: previsto x arrecadado - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, arrec_ant_acum,	arrec_acum)
ant <- select(data, mes, arrec_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant_acum
ant$arrec_ant_acum <- NULL
atual <- select(data, mes, arrec_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_acum
atual$arrec_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle("Receita Total: ano anterior x ano atual - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_acum)
prev$valor <- prev$prev_acum
prev$prev_acum <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_acum)
arrec$valor <- arrec$arrec_acum
arrec$arrec_acum <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Receita Total: previsto x arrecadado - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

### Contribuição dos Servidores Ativos, Inativos e Pensionistas

A contribuição dos servidores ativos, inativos e pensionistas é prevista em lei à alíquota de 14% sobre o salário contribuição.

```{r}
df <- readxl::read_excel(ds_file, sheet = "ContribServ")
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant,	prev_mes,	arrec_mes),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição dos Servidores (Mensal)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant_acum,	prev_acum,	arrec_acum),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição dos Servidores (Acumulado)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```
```{r}
data <- select(df, mes, arrec_ant,	arrec_mes)
ant <- select(data, mes, arrec_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant
ant$arrec_ant <- NULL
atual <- select(data, mes, arrec_mes)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_mes
atual$arrec_mes <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle("Contribuição dos Servidores: ano anterior x ano atual - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_mes)
prev$valor <- prev$prev_mes
prev$prev_mes <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_mes)
arrec$valor <- arrec$arrec_mes
arrec$arrec_mes <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Contribuição dos Servidores: previsto x arrecadado - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, arrec_ant_acum,	arrec_acum)
ant <- select(data, mes, arrec_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant_acum
ant$arrec_ant_acum <- NULL
atual <- select(data, mes, arrec_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_acum
atual$arrec_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle("Contribuição dos Servidores: ano anterior x ano atual - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_acum)
prev$valor <- prev$prev_acum
prev$prev_acum <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_acum)
arrec$valor <- arrec$arrec_acum
arrec$arrec_acum <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Contribuição dos Servidores: previsto x arrecadado - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

### Contribuição Patronal – alíquota normal

A contrbiuição patronal normal está prevista em lei no percentual de 14% sobre a totalidade do salário contribuição e corresponde à contrapartida do Município à contribuição dos servidores para o FPSM.

```{r}
df <- readxl::read_excel(ds_file, sheet = "PatronalNormal")
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant,	prev_mes,	arrec_mes),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição Patronal Normal (Mensal)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant_acum,	prev_acum,	arrec_acum),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição Patronal Normal (Acumulado)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```
```{r}
data <- select(df, mes, arrec_ant,	arrec_mes)
ant <- select(data, mes, arrec_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant
ant$arrec_ant <- NULL
atual <- select(data, mes, arrec_mes)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_mes
atual$arrec_mes <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle("Contribuição Patronal Normal: ano anterior x ano atual - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_mes)
prev$valor <- prev$prev_mes
prev$prev_mes <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_mes)
arrec$valor <- arrec$arrec_mes
arrec$arrec_mes <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Contribuição Patronal Normal: previsto x arrecadado - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, arrec_ant_acum,	arrec_acum)
ant <- select(data, mes, arrec_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant_acum
ant$arrec_ant_acum <- NULL
atual <- select(data, mes, arrec_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_acum
atual$arrec_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle("Contribuição Patronal Normal: ano anterior x ano atual - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_acum)
prev$valor <- prev$prev_acum
prev$prev_acum <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_acum)
arrec$valor <- arrec$arrec_acum
arrec$arrec_acum <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Contribuição Patronal Normal: previsto x arrecadado - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

### Contribuição Patronal – alíquota suplementar

A contribuição patronal suplementar é a destinada à amortização do passivo atuarial identificado em avaliação atuarial periódica e tem alíquota definida em lei de forma escalonada em cada exercício financeiro.

```{r}
df <- readxl::read_excel(ds_file, sheet = "PatronalSuplementar")
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant,	prev_mes,	arrec_mes),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição Patronal Suplementar (Mensal)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant_acum,	prev_acum,	arrec_acum),
  align=c("l", "r", "r", "r"),
  caption = "Contribuição Patronal Suplementar (Acumulado)",
  col.names = c("Mês", "Ano Anterior", "Previsto", "Arrecadado")
)
tbl
```
```{r}
data <- select(df, mes, arrec_ant,	arrec_mes)
ant <- select(data, mes, arrec_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant
ant$arrec_ant <- NULL
atual <- select(data, mes, arrec_mes)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_mes
atual$arrec_mes <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle("Contribuição Patronal Suplementar: ano anterior x ano atual - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_mes)
prev$valor <- prev$prev_mes
prev$prev_mes <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_mes)
arrec$valor <- arrec$arrec_mes
arrec$arrec_mes <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Contribuição Patronal Suplementar: previsto x arrecadado - valor mensal") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, arrec_ant_acum,	arrec_acum)
ant <- select(data, mes, arrec_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant_acum
ant$arrec_ant_acum <- NULL
atual <- select(data, mes, arrec_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_acum
atual$arrec_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle("Contribuição Patronal Suplementar: ano anterior x ano atual - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_acum)
prev$valor <- prev$prev_acum
prev$prev_acum <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_acum)
arrec$valor <- arrec$arrec_acum
arrec$arrec_acum <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Contribuição Patronal Suplementar: previsto x arrecadado - valor acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

## Disponibilidades do RPPS

Esta seção apresenta dados sobre as disponibilidades e investimentos do RPPS.

### Disponibilidades de Caixa do RPPS

As disponibilidades de caixa e equivalentes são apresentadas englobando os recursos vinculados à previdência e os da taxa administrativa.

O saldo projetado apresentado considera o saldo inicial do período, somando-se a previsão de receitas e subtraindo-se a previsão de despesas conforme a programação financeira estabelecida.

```{r}
df <- readxl::read_excel(ds_file, sheet = "Caixa", skip = 1)
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, projetado,	atual),
  align=c("l", "r", "r"),
  caption = "Saldo de Caixa e Equivalentes de Caixa e Investimentos",
  col.names = c("Mês", "Saldo Projetado", "Saldo Efetivo")
)
tbl
```

```{r}
t1 <- select(df, mes, projetado)
t1$valor <- t1$projetado
t1$projetado <- NULL
t1$tipo <- "Saldo projetado"
t2 <- select(df, mes, atual)
t2$valor <- t2$atual
t2$atual <- NULL
t2$tipo <- "Saldo efetivo"
data <- rbind(t1, t2)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Saldo de caixa e investimentos: projetado x efetivo") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

O que se pretende com essa demonstração é dar uma ideia do desempenho da gestão do RPPS em termos de geração de caixa, visto que uma de suas finalidades é justamente a geração de caixa para fazer frente aos benefícios futuros dos segurados.

## Valorização e Desvalorização dos Investimentos

A gestão dos investimentos é feita por comitê especialmente constituído para esta finalidade, bem como por servidor imbuído da função de gestor de investimentos, cabendo ao serviço de contabilidade o registro dos fatos que impactam esses ativos.

Com isso em mente, este relatório se abstém de formar opinião sobre esse tema, visto que a competência para tal é dos citados comitê e gestor de investimentos.

### Valorização/Desvalorização dos Investimentos do RPPS

Nesta subseção estão refletidas as variações de valor dos investimentos do RPPS.

A metodologia de registro é a seguinte:

No caso de valorização, ocorre o registro de receita orçamentária;

Havendo desvalorização, ocorre o registro orçamentário de dedução de receita até o montante em que o saldo acumulado da dedução de receita é igual ao saldo acumulado da receita orçamentária principal. A desvalorização que supere esse valor é registrada sem execução orçamentária.

Embora essa metodologia simplifique o controle das variações de valor dos investimentos, ela traz como consequência a eventual divergência entre a desvalorização e o registro de dedução de receita orçamentária.

```{r}
df <- readxl::read_excel(ds_file, sheet = "GanhosPerdasRend", range = cellranger::cell_cols("A:G"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant,	prev_mes, arrec_mes),
  align=c("l", "r", "r", "r", "r"),
  caption = "Variação das aplicações financeiras: valores mensais",
  col.names = c("Mês", paste("Desempenho", as.integer(ano_base) - 1), paste("Previsto", ano_base), paste("Desempenho", ano_base))
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, arrec_ant_acum,	prev_acum, arrec_acum),
  align=c("l", "r", "r", "r", "r"),
  caption = "Variação das aplicações financeiras: valores acumulados",
  col.names = c("Mês", paste("Desempenho", as.integer(ano_base) - 1), paste("Previsto", ano_base), paste("Desempenho", ano_base))
)
tbl
```

```{r}
data <- select(df, mes, arrec_ant,	arrec_mes)
ant <- select(data, mes, arrec_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant
ant$arrec_ant <- NULL
atual <- select(data, mes, arrec_mes)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_mes
atual$arrec_mes <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Desempenho mensal dos investimentos:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_mes)
prev$valor <- prev$prev_mes
prev$prev_mes <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_mes)
arrec$valor <- arrec$arrec_mes
arrec$arrec_mes <- NULL
arrec$tipo <- "Realizado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Desempenho mensal dos investimentos: previsto x realizado") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, arrec_ant_acum,	arrec_acum)
ant <- select(data, mes, arrec_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$arrec_ant_acum
ant$arrec_ant_acum <- NULL
atual <- select(data, mes, arrec_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$arrec_acum
atual$arrec_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Desempenho acumulado dos investimentos:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

```{r}
prev <- select(df, mes, prev_acum)
prev$valor <- prev$prev_acum
prev$prev_acum <- NULL
prev$tipo <- "Previsto"
arrec <- select(df, mes, arrec_acum)
arrec$valor <- arrec$arrec_acum
arrec$arrec_acum <- NULL
arrec$tipo <- "Arrecadado"
data <- rbind(prev, arrec)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, linetype = tipo)) +
  ggtitle("Desempenho acumulado dos investimentos: previsto x acumulado") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("solid", "dashed"))
g <- app.plot.theming(g)
g
```

## Despesas Orçamentárias

As despesas orçamentárias do RPPS são apresentadas nesta seção com base nos valores empenhados mensal e acumulado, comparados aos valores correspondentes do ano anterior.

### Despesa Total

Engloba a totalidade das despesas empenhadas pelo FPSM, inclusive as intra-orçamentárias.

```{r}
df <- readxl::read_excel(ds_file, sheet = "DespesaTotal", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesa Total: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesa Total: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesa Total Mensal:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesa Total Acumulada:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

### Despesa com Inativos e Pensionistas do RPPS

Os valores ora apresentados dizem respeito às despesas com inativos e pensionistas que passaram a integrar o RPPS após a sua criação, onerando o fundo em capitalização (plano previdenciário).

```{r}
df <- readxl::read_excel(ds_file, sheet = "InativPensRPPS", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesa com Inativos e Pensionistas do RPPS: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesa com Inativos e Pensionistas do RPPS: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesa Mensal com Inativos e Pensionistas do RPPS:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesa Acumulada com Inativos e Pensionistas do RPPS:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

### Despesa com Inativos e Pensionistas do Tesouro

Com a criação do atual fundo de previdência, os inativos e pensionistas já existentes foram incorporados ao RPPS cabendo o seu custeio, a partir daí, ao RPPS. Não houve previsão de repasse ou compensação financeira por parte do Executivo da parcela de despesas desses inativos e pensionistas[^1].

Desta forma, a segregação orçamentária desse público se dá apenas para fins gerenciais e de transparência.


```{r}
df <- readxl::read_excel(ds_file, sheet = "InativPensTesouro", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesa com Inativos e Pensionistas do Tesouro: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesa com Inativos e Pensionistas do Tesouro: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesa Mensal com Inativos e Pensionistas do Tesouro:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesa Acumulada com Inativos e Pensionistas do Tesouro:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

### Despesas Administrativas do RPPS

São as despesas destinadas à manutenção do FPSM, inclusive sua estrutura de gestão e serviços de apoio administrativo.

```{r}
df <- readxl::read_excel(ds_file, sheet = "Manut", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesas Administrativas do RPPS: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesas Administrativas do RPPS: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesas Administrativas Mensais do RPPS:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesas Administrativas Acumulada do RPPS:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

### Despesas com Aposentadorias

Engloba todas as aposentadorias pagas pelo FPSM.

```{r}
df <- readxl::read_excel(ds_file, sheet = "Aposentadorias", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesas com Aposentadorias: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesas com Aposentadorias: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesas Mensais com Aposentadorias:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesas Acumuladas com Aposentadorias:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

### Despesas com Pensões

Considera a totalidade das pensões a dependentes de segurados falecidos.

```{r}
df <- readxl::read_excel(ds_file, sheet = "Pensoes", range = cellranger::cell_cols("A:E"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant, emp_atual),
  align=c("l", "r", "r"),
  caption = "Despesas com Pensões: empenhado mensal",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, emp_ant_acum, emp_atual_acum),
  align=c("l", "r", "r"),
  caption = "Despesas com Pensões: empenhado acumulado",
  col.names = c("Mês", as.integer(ano_base) - 1, ano_base)
)
tbl
```

```{r}
data <- select(df, mes, emp_ant,	emp_atual)
ant <- select(data, mes, emp_ant)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant
ant$emp_ant <- NULL
atual <- select(data, mes, emp_atual)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual
atual$emp_atual <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, fill = ano)) +
  ggtitle(paste("Despesas Mensais com Pensões:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, mes, emp_ant_acum,	emp_atual_acum)
ant <- select(data, mes, emp_ant_acum)
ant$ano <- (as.integer(ano_base) - 1)
ant$valor <- ant$emp_ant_acum
ant$emp_ant_acum <- NULL
atual <- select(data, mes, emp_atual_acum)
atual$ano <- as.integer(ano_base)
atual$valor <- atual$emp_atual_acum
atual$emp_atual_acum <- NULL
data <- rbind(ant, atual)
data$ano <- as.factor(data$ano)
data$mes <- as.factor(data$mes)

g <- ggplot(data, aes(x = mes, group = ano, linetype = ano)) +
  ggtitle(paste("Despesas Acumuladas com Pensões:", as.integer(ano_base) - 1, "x", ano_base)) +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = unique(df$mes)) +
  scale_linetype_manual(values = c("dashed", "solid"))
g <- app.plot.theming(g)
g
```

## Dívida do Executivo em Regime de Parcelamento

O Poder Executivo mantém um parcelamento de contribuições e outros valores não repassados e de empréstimos feitos junto ao RPPS. Esse parcelamento foi autorizado em 360 parcelas sendo que para o ano de 2022 foram pagas as parcelas 203 a 214.

Como forma de acompanhamento dos valores recebidos e do saldo devedor, foi elaborada projeção atualizada pela estimativa do IPCA englobando todo o período do parcelamento.

Também são apresentados os valores efetivamente realizados.

```{r}
df <- readxl::read_excel(ds_file, sheet = "Divida")
df$ano <- as.factor(df$ano)
```

```{r}
tbl = app.table.default(
  select(df, ano, saldo_inicial, saldo_projetado, valor_pago, pagamento_projetado),
  align=c("l", "r", "r", "r", "r"),
  caption = "Dívida do Executivo em Regime de Parcelamento",
  col.names = c("Ano", "Saldo Inicial", "Saldo Projetado", "Valor Pago", "Pagamento Projetado")
)
tbl
```

```{r}
data <- select(df, ano, saldo_inicial, saldo_projetado)
inicial <- select(data, ano, saldo_inicial)
inicial$valor <- inicial$saldo_inicial
inicial$saldo_inicial <- NULL
inicial$tipo <- "Saldo inicial"
projetado <- select(data, ano, saldo_projetado)
projetado$valor <- projetado$saldo_projetado
projetado$saldo_projetado <- NULL
projetado$tipo <- "Saldo projetado"
data <- rbind(inicial, projetado)
data$ano <- as.factor(data$ano)

g <- ggplot(data, aes(x = ano, group = tipo, linetype = tipo)) +
  ggtitle("Evolução do saldo devedor") +
  geom_line(aes(y = valor), na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = levels(data$ano)) +
  scale_linetype_manual(values = c("solid", "dashed")) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
g <- app.plot.theming(g)
g
```

```{r}
data <- select(df, ano, valor_pago, pagamento_projetado)
inicial <- select(data, ano, valor_pago)
inicial$valor <- inicial$valor_pago
inicial$valor_pago <- NULL
inicial$tipo <- "Valor pago"
projetado <- select(data, ano, pagamento_projetado)
projetado$valor <- projetado$pagamento_projetado
projetado$pagamento_projetado <- NULL
projetado$tipo <- "Pagamento projetado"
data <- rbind(inicial, projetado)
data$ano <- as.factor(data$ano)

g <- ggplot(data, aes(x = ano, group = tipo, fill = tipo)) +
  ggtitle("Evolução dos pagamentos") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = levels(data$ano)) +
  scale_fill_manual(values = c(app.color.secondary, app.color.primary)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
g <- app.plot.theming(g)
g
```

## Compensação Previdenciária

A compensação previdenciária entre o RPPS e o RGPS e outros RPPS tem a finalidade de transferir os recursos de contribuições dos segurados e patronal para os RPPS nos quais o segurado efetivamente se inativou ou gerou pensionistas.

Assim, demonstra-se a seguir o balanço entre os recursos recebidos de outros RPPS e do RGPS e aqueles transferidos a eles pelo FPSM.

```{r}
df <- readxl::read_excel(ds_file, sheet = "COMPREV", range = cellranger::cell_cols("A:F"))
df$ano <- as.factor(format(df$data_base, format = "%Y"))
df$mes <- as.factor(format(df$data_base, format = "%b"))
df <- df[df$ano==ano_base,]
```

```{r}
tbl = app.table.default(
  select(df, mes, receita, despesa),
  align=c("l", "r", "r"),
  caption = "Compensação Previdenciária: receitas x despesas (valores mensais)",
  col.names = c("Mês", "Receita", "Despesa")
)
tbl
```

```{r}
tbl = app.table.default(
  select(df, mes, receita_acum, despesa_acum),
  align=c("l", "r", "r"),
  caption = "Compensação Previdenciária: receitas x despesas (valores acumulados)",
  col.names = c("Mês", "Receita", "Despesa")
)
tbl
```

```{r}
receita <- select(df, mes, receita)
receita$valor <- receita$receita
receita$receita <- NULL
receita$tipo <- "Receita"
despesa <- select(df, mes, despesa)
despesa$valor <- despesa$despesa
despesa$despesa <- NULL
despesa$tipo <- "Despesa"
data <- rbind(receita, despesa)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Compensação Previdenciária: receita x despesa (valores mensais)") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
receita <- select(df, mes, receita_acum)
receita$valor <- receita$receita_acum
receita$receita_acum <- NULL
receita$tipo <- "Receita"
despesa <- select(df, mes, despesa_acum)
despesa$valor <- despesa$despesa_acum
despesa$despesa_acum <- NULL
despesa$tipo <- "Despesa"
data <- rbind(receita, despesa)

data$mes <- as.factor(data$mes)
g <- ggplot(data, aes(x = mes, group = tipo, fill = tipo)) +
  ggtitle("Compensação Previdenciária: receita x despesa (valores acumulados)") +
  geom_bar(aes(y = valor), stat = "identity", position = "dodge", na.rm = TRUE) +
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
  scale_x_discrete(limits = df$mes) +
  scale_fill_manual(values = c(app.color.primary, app.color.secondary))
g <- app.plot.theming(g)
g
```

```{r}
df <- readxl::read_excel(ds_file, sheet = "COMPREV", range = cellranger::cell_cols("H"))
saldo <- format(as.numeric(df$saldo), digits = 2, big.mark = ".", decimal.mark = ",")
```

Cabe destacar que, segundo a avaliação atuarial vigente, o valor a receber a título de compensação previdenciária é de  R$ `r saldo`.

# Considerações Finais

Como já referido, o serviço de contabilidade limita-se à sua função primária, que é a de fornecer informações confiáveis, relevantes e tempestivas com vistas a apoiar o processo de tomada de decisão e à prestação de contas, atendendo ao princípio da transparência.

Cabe à gestão do RPPS, primariamente, a avaliação da gestão bem como identificais oportunidades e ameaças e, por esse motivo, é que este relatório se abstém de formar qualquer juízo a respeito da eficiência, eficácia e efetividade da gestão do patrimônio do RPPS, tarefa que derradeiramente cabe aos órgãos de controle e, aos segurados como um todo.








Independência, RS, `r format(Sys.Date(), format = "%d de %B de %Y")`


***

**Notas**

[^1]: Inteligência do art. 70 da Lei Municipal nº 1.701/2005.